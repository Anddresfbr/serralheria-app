<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Serralheria Bom Preço - Gerenciador de Orçamentos</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6;
        }
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; border-radius: 10px; }
        ::-webkit-scrollbar-thumb { background: #888; border-radius: 10px; }
        ::-webkit-scrollbar-thumb:hover { background: #555; }
        .card-hover:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
        .modal {
            display: none; position: fixed; z-index: 1000; left: 0; top: 0;
            width: 100%; height: 100%; overflow: auto; background-color: rgba(0,0,0,0.6);
            align-items: center; justify-content: center; padding: 1rem;
        }
        .modal-content {
            background-color: #1f2937; color: #e5e7eb; margin: auto; padding: 25px;
            border: 1px solid #374151; width: 90%; max-width: 600px; 
            border-radius: 0.75rem; box-shadow: 0 10px 25px rgba(0,0,0,0.3);
        }
        .modal-header {
            padding-bottom: 1rem; border-bottom: 1px solid #374151; margin-bottom: 1.5rem;
            font-size: 1.25rem; font-weight: 600; color: #60a5fa;
        }
        .modal-footer {
            padding-top: 1rem; border-top: 1px solid #374151; margin-top: 1.5rem;
        }
        .logo-container { display: flex; flex-direction: column; align-items: center; margin-bottom: 1.5rem; }
        .logo-container img { max-width: 150px; margin-bottom: 0.75rem; border-radius: 0.5rem; background-color: white; padding: 5px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); }
        
        .orcamento-total-item { display: flex; justify-content: space-between; align-items: center; padding: 0.5rem 0; border-bottom: 1px solid #e5e7eb; }
        .orcamento-total-item:last-child { border-bottom: none; }
        .orcamento-total-label { font-weight: 500; color: #4b5563; }
        .orcamento-total-value { font-weight: 600; color: #1f2937; }
        .orcamento-total-geral .orcamento-total-label,
        .orcamento-total-geral .orcamento-total-value { font-size: 1.25rem; font-weight: 700; color: #166534; }
        .input-currency, .input-percent { width: 80px; padding: 0.25rem 0.5rem; border: 1px solid #d1d5db; border-radius: 0.375rem; text-align: right; }

        @media print {
            body { background-color: #fff; }
            body > *:not(#printableArea) { display: none !important; }
            #printableArea { visibility: visible !important; display: block !important; position: absolute; left: 0; top: 0; width: 100%; font-size: 12px; color: #000 !important; }
            #printableArea h1, #printableArea h2, #printableArea h3, #printableArea h4 { color: #000 !important; }
            #printableArea .print-header img { max-width: 100px; margin-bottom: 10px; }
            #printableArea table { width: 100%; border-collapse: collapse; margin-bottom: 15px; }
            #printableArea th, #printableArea td { border: 1px solid #ccc; padding: 6px; text-align: left; }
            #printableArea th { background-color: #f0f0f0; }
            #printableArea .print-summary-item { display: flex; justify-content: space-between; padding: 4px 0; font-size: 13px; }
            #printableArea .print-summary-item.total { font-weight: bold; font-size: 14px; border-top: 1px solid #000; padding-top: 8px; margin-top: 8px; }
            .no-print { display: none !important; }
        }
        #printableArea { display: none; }
    </style>
</head>
<body class="flex flex-col items-center p-4 min-h-screen">

    <div id="login-screen" class="bg-white shadow-2xl rounded-xl p-10 w-full max-w-md text-center">
        <div class="logo-container">
            <img src="" alt="Logo da Serralheria Bom Preço" id="loginLogo">
            <h1 id="loginCompanyName" class="text-3xl font-bold text-sky-600"></h1>
        </div>
        <p class="text-slate-600 mb-8">Bem-vindo ao Gerenciador de Orçamentos.</p>
        <button id="google-login-btn" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 px-6 rounded-lg transition flex items-center justify-center space-x-3">
            <svg class="w-6 h-6" viewBox="0 0 48 48"><path fill="#FFC107" d="M43.611 20.083H42V20H24v8h11.303c-1.649 4.657-6.08 8-11.303 8c-6.627 0-12-5.373-12-12s5.373-12 12-12c3.059 0 5.842 1.154 7.961 3.039l5.657-5.657C34.046 6.053 29.268 4 24 4C12.955 4 4 12.955 4 24s8.955 20 20 20s20-8.955 20-20c0-1.341-.138-2.65-.389-3.917z"></path><path fill="#FF3D00" d="M6.306 14.691l6.571 4.819C14.655 15.108 18.961 12 24 12c3.059 0 5.842 1.154 7.961 3.039l5.657-5.657C34.046 6.053 29.268 4 24 4C16.318 4 9.656 8.337 6.306 14.691z"></path><path fill="#4CAF50" d="M24 44c5.166 0 9.86-1.977 13.409-5.192l-6.19-5.238C29.211 35.091 26.715 36 24 36c-5.202 0-9.619-3.317-11.283-7.946l-6.522 5.025C9.505 39.556 16.227 44 24 44z"></path><path fill="#1976D2" d="M43.611 20.083H42V20H24v8h11.303c-.792 2.237-2.231 4.166-4.087 5.571l6.19 5.238C42.012 36.49 44 30.686 44 24c0-1.341-.138-2.65-.389-3.917z"></path></svg>
            <span>Entrar com Google</span>
        </button>
        <p id="loginFeedback" class="mt-4 text-sm text-red-600"></p>
    </div>

    <div id="home-screen" class="w-full max-w-3xl mx-auto" style="display: none;">
        <header class="text-center mb-8">
            <div class="logo-container mb-4">
                 <img src="" alt="Logo da Serralheria Bom Preço" id="homeLogo">
                 <h1 id="homeCompanyName" class="text-3xl md:text-4xl font-bold text-sky-600"></h1>
            </div>
            <p class="text-slate-600 text-lg">Selecione uma opção para começar.</p>
            <div class="mt-4 text-xs text-slate-500">
                <p>Usuário: <span id="userEmailDisplayHome" class="font-mono text-slate-700"></span></p>
                 <button id="logout-btn-home" class="mt-2 text-sm text-red-600 hover:underline">Sair</button>
            </div>
        </header>
        <div class="grid grid-cols-2 md:grid-cols-3 gap-4 md:gap-6">
            <button id="btn-goto-orcamentos" class="nav-card bg-white p-6 rounded-xl shadow-md hover:shadow-lg hover:-translate-y-1 transition-all flex flex-col items-center justify-center text-center">
                <div class="bg-sky-100 p-3 rounded-full mb-3"><svg class="w-8 h-8 text-sky-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M19.5 14.25v-2.625a3.375 3.375 0 0 0-3.375-3.375h-1.5A1.125 1.125 0 0 1 13.5 7.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H8.25m0 12.75h7.5m-7.5 3H12M10.5 2.25H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 0 0-9-9Z" /></svg></div>
                <h2 class="font-semibold text-slate-700">Orçamentos</h2><p class="text-xs text-slate-500">Ver e pesquisar</p>
            </button>
            <button id="btn-goto-clientes" class="nav-card bg-white p-6 rounded-xl shadow-md hover:shadow-lg hover:-translate-y-1 transition-all flex flex-col items-center justify-center text-center">
                <div class="bg-teal-100 p-3 rounded-full mb-3"><svg class="w-8 h-8 text-teal-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M18 18.72a9.094 9.094 0 0 0 3.741-.479 3 3 0 0 0-4.682-2.72m-7.5-2.962a4.5 4.5 0 1 1 9 0 4.5 4.5 0 0 1-9 0Zm-7.5 2.962c0-1.331.39-2.585 1.08-3.654a7.525 7.525 0 0 1 11.238-3.888A9.06 9.06 0 0 1 21 18.72m-18 0v-2.16C3 13.621 5.02 12 7.5 12h3" /></svg></div>
                <h2 class="font-semibold text-slate-700">Clientes</h2><p class="text-xs text-slate-500">Gerenciar contatos</p>
            </button>
            <button id="btn-goto-catalogo" class="nav-card bg-white p-6 rounded-xl shadow-md hover:shadow-lg hover:-translate-y-1 transition-all flex flex-col items-center justify-center text-center">
                <div class="bg-amber-100 p-3 rounded-full mb-3"><svg class="w-8 h-8 text-amber-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M2.25 12.75V12A2.25 2.25 0 0 1 4.5 9.75h15A2.25 2.25 0 0 1 21.75 12v.75m-8.69-6.44-2.12-2.12a1.5 1.5 0 0 0-1.061-.44H4.5A2.25 2.25 0 0 0 2.25 6v12a2.25 2.25 0 0 0 2.25 2.25h15A2.25 2.25 0 0 0 21.75 18V9a2.25 2.25 0 0 0-2.25-2.25h-5.379a1.5 1.5 0 0 1-1.06-.44Z" /></svg></div>
                <h2 class="font-semibold text-slate-700">Catálogo</h2><p class="text-xs text-slate-500">Ver materiais e preços</p>
            </button>
        </div>
        <div class="mt-8">
            <button id="btn-goto-novo-orcamento" class="w-full bg-teal-600 hover:bg-teal-700 text-white font-bold py-4 px-6 rounded-lg transition-all shadow-lg hover:shadow-xl flex items-center justify-center space-x-3">
                <svg class="w-6 h-6" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M12 4.5v15m7.5-7.5h-15" /></svg>
                <span>Criar Novo Orçamento</span>
            </button>
        </div>
    </div>

    <div id="main-app-content" class="w-full" style="display: none;">
        <div class="bg-white shadow-2xl rounded-xl p-6 md:p-10 w-full max-w-3xl text-slate-800 no-print mx-auto">
            <header class="mb-8 text-center relative">
                <button id="btn-back-to-home" title="Voltar ao Início" class="absolute top-0 left-0 bg-slate-200 hover:bg-slate-300 p-2 rounded-full transition-colors">
                    <svg class="w-6 h-6 text-slate-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M2.25 12l8.954-8.955c.44-.439 1.152-.439 1.591 0L21.75 12M4.5 9.75v10.125c0 .621.504 1.125 1.125 1.125H9.75v-4.875c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125V21h4.125c.621 0 1.125-.504 1.125-1.125V9.75M8.25 21h7.5" /></svg>
                </button>
                <div class="logo-container">
                    <img src="" alt="Logo da Serralheria Bom Preço" id="companyLogo">
                    <h1 id="mainCompanyName" class="text-3xl md:text-4xl font-bold text-sky-600"></h1>
                </div>
                <p class="text-slate-600 mt-2">Gerenciador de Orçamentos</p>
                <div class="mt-4 text-xs text-slate-500">
                    <p>Usuário: <span id="userEmailDisplay" class="font-mono text-slate-700">Carregando...</span></p>
                    <button id="logout-btn" class="mt-2 text-sm text-red-600 hover:underline">Sair</button>
                </div>
            </header>
            
            <section id="clients-section" class="app-section mb-10" style="display: none;">
                <h2 class="text-2xl font-semibold text-sky-600 mb-6 text-center">Gerenciar Clientes</h2>
                <div class="mb-8 p-4 border border-slate-200 rounded-lg bg-slate-50">
                    <h3 id="clientFormTitle" class="text-lg font-semibold text-sky-700 mb-3">Cadastrar Novo Cliente</h3>
                    <form id="addClientForm" class="space-y-4">
                        <input type="hidden" id="editingClientId">
                        <div>
                            <label for="clientName" class="block text-sm font-medium text-sky-700 mb-1">Nome Completo</label>
                            <input type="text" id="clientName" required class="w-full px-4 py-3 bg-white border border-slate-300 rounded-lg text-slate-900 focus:ring-2 focus:ring-sky-500 outline-none placeholder-slate-400" placeholder="Nome do cliente">
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label for="clientDocumentType" class="block text-sm font-medium text-sky-700 mb-1">Tipo de Documento</label>
                                <select id="clientDocumentType" class="w-full px-4 py-3 bg-white border border-slate-300 rounded-lg text-slate-900 focus:ring-2 focus:ring-sky-500 outline-none">
                                    <option value="cpf">Pessoa Física (CPF)</option>
                                    <option value="cnpj">Pessoa Jurídica (CNPJ)</option>
                                </select>
                            </div>
                            <div>
                                <label for="clientDocument" class="block text-sm font-medium text-sky-700 mb-1">CPF / CNPJ</label>
                                <input type="text" id="clientDocument" class="w-full px-4 py-3 bg-white border border-slate-300 rounded-lg text-slate-900 focus:ring-2 focus:ring-sky-500 outline-none placeholder-slate-400">
                            </div>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label for="clientPhone" class="block text-sm font-medium text-sky-700 mb-1">Telefone / WhatsApp</label>
                                <input type="text" id="clientPhone" class="w-full px-4 py-3 bg-white border border-slate-300 rounded-lg text-slate-900 focus:ring-2 focus:ring-sky-500 outline-none placeholder-slate-400" placeholder="(99) 99999-9999">
                            </div>
                            <div>
                                <label for="clientEmail" class="block text-sm font-medium text-sky-700 mb-1">Email</label>
                                <input type="email" id="clientEmail" class="w-full px-4 py-3 bg-white border border-slate-300 rounded-lg text-slate-900 focus:ring-2 focus:ring-sky-500 outline-none placeholder-slate-400" placeholder="email@exemplo.com">
                            </div>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                            <div class="md:col-span-1">
                                <label for="clientCep" class="block text-sm font-medium text-sky-700 mb-1">CEP</label>
                                <input type="text" id="clientCep" maxlength="9" class="w-full px-4 py-3 bg-white border border-slate-300 rounded-lg text-slate-900 focus:ring-2 focus:ring-sky-500 outline-none placeholder-slate-400" placeholder="00000-000">
                            </div>
                            <div class="md:col-span-3">
                                <label for="clientStreet" class="block text-sm font-medium text-sky-700 mb-1">Rua / Logradouro</label>
                                <input type="text" id="clientStreet" class="w-full px-4 py-3 bg-white border border-slate-300 rounded-lg text-slate-900 focus:ring-2 focus:ring-sky-500 outline-none placeholder-slate-400">
                            </div>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                            <div class="md:col-span-1">
                                <label for="clientNumber" class="block text-sm font-medium text-sky-700 mb-1">Número</label>
                                <input type="text" id="clientNumber" class="w-full px-4 py-3 bg-white border border-slate-300 rounded-lg text-slate-900 focus:ring-2 focus:ring-sky-500 outline-none placeholder-slate-400">
                            </div>
                            <div class="md:col-span-3">
                                <label for="clientNeighborhood" class="block text-sm font-medium text-sky-700 mb-1">Bairro</label>
                                <input type="text" id="clientNeighborhood" class="w-full px-4 py-3 bg-white border border-slate-300 rounded-lg text-slate-900 focus:ring-2 focus:ring-sky-500 outline-none placeholder-slate-400">
                            </div>
                        </div>
                        <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                            <div class="md:col-span-3">
                                <label for="clientCity" class="block text-sm font-medium text-sky-700 mb-1">Cidade</label>
                                <input type="text" id="clientCity" class="w-full px-4 py-3 bg-white border border-slate-300 rounded-lg text-slate-900 focus:ring-2 focus:ring-sky-500 outline-none placeholder-slate-400">
                            </div>
                            <div class="md:col-span-1">
                                <label for="clientState" class="block text-sm font-medium text-sky-700 mb-1">Estado (UF)</label>
                                <input type="text" id="clientState" maxlength="2" class="w-full px-4 py-3 bg-white border border-slate-300 rounded-lg text-slate-900 focus:ring-2 focus:ring-sky-500 outline-none placeholder-slate-400">
                            </div>
                        </div>
                        <div class="flex items-center justify-end space-x-4 pt-2">
                            <button type="button" id="btnCancelEditClient" class="text-sm text-slate-600 hover:underline" style="display: none;">Cancelar Edição</button>
                            <button type="submit" id="btnSaveClient" class="bg-teal-600 hover:bg-teal-700 text-white font-semibold py-2 px-6 rounded-lg transition">Salvar Cliente</button>
                        </div>
                        <div id="clientFormFeedback" class="mt-3 text-sm text-center"></div>
                    </form>
                </div>
                <h3 class="text-xl font-semibold text-sky-700 mb-4 text-center">Clientes Cadastrados</h3>
                <div class="mb-6">
                    <label for="searchClients" class="sr-only">Pesquisar Clientes</label>
                    <input type="text" id="searchClients" class="w-full px-4 py-3 bg-white border border-slate-300 rounded-lg text-slate-900 focus:ring-2 focus:ring-sky-500 outline-none placeholder-slate-400" placeholder="Pesquisar por nome, CPF/CNPJ ou telefone...">
                </div>
                <div id="clientsList" class="space-y-4" style="display: none;"> </div>
                <p id="noClientsMessage" class="text-slate-500 text-center p-4 border-2 border-dashed border-slate-300 rounded-md">Digite na barra acima para pesquisar um cliente.</p>
            </section>

            <hr class="app-section-separator border-slate-300 my-10" style="display: none;">

            <section id="orcamento-section" class="app-section mb-10" style="display: none;">
                <h2 id="orcamentoFormTitle" class="text-2xl font-semibold text-sky-600 mb-6 text-center">Criar Novo Orçamento</h2>
                <div class="mb-4 p-4 border border-slate-200 rounded-lg bg-slate-50 space-y-4">
                    <input type="hidden" id="editingBudgetId">
                    <div>
                        <label for="orcamentoClienteNome" class="block text-sm font-medium text-sky-700 mb-1">Nome do Cliente</label>
                        <input type="text" id="orcamentoClienteNome" list="clientDatalist" class="w-full px-4 py-3 bg-white border border-slate-300 rounded-lg text-slate-900 focus:ring-2 focus:ring-sky-500 outline-none placeholder-slate-400" placeholder="Selecione ou digite o nome do cliente">
                        <datalist id="clientDatalist"></datalist>
                    </div>
                    <div>
                        <label for="orcamentoServicoDescricao" class="block text-sm font-medium text-sky-700 mb-1">Descrição do Serviço/Orçamento</label>
                        <textarea id="orcamentoServicoDescricao" rows="3" class="w-full px-4 py-3 bg-white border border-slate-300 rounded-lg text-slate-900 focus:ring-2 focus:ring-sky-500 outline-none placeholder-slate-400" placeholder="Ex: Fabricação e instalação de grade..."></textarea>
                    </div>
                    <div>
                        <label for="orcamentoStatus" class="block text-sm font-medium text-sky-700 mb-1">Status do Orçamento</label>
                        <select id="orcamentoStatus" class="w-full px-4 py-3 bg-white border border-slate-300 rounded-lg text-slate-900 focus:ring-2 focus:ring-sky-500 outline-none">
                            <option value="Pendente" class="text-blue-600 font-semibold">Pendente</option>
                            <option value="Aprovado" class="text-green-600 font-semibold">Aprovado</option>
                            <option value="Recusado" class="text-red-600 font-semibold">Recusado</option>
                        </select>
                    </div>
                </div>
                <div class="mb-6 p-4 border border-slate-200 rounded-lg bg-slate-50">
                    <h3 class="text-lg font-semibold text-sky-700 mb-3">Adicionar Item ao Orçamento</h3>
                    <div class="grid grid-cols-1 md:grid-cols-6 gap-4 items-end">
                        <div class="md:col-span-3">
                            <label for="searchMaterialToAdd" class="block text-sm font-medium text-sky-700 mb-1">Pesquisar Material</label>
                            <input type="text" id="searchMaterialToAdd" list="materialDatalist" class="w-full px-4 py-3 bg-white border border-slate-300 rounded-lg text-slate-900 focus:ring-2 focus:ring-sky-500 outline-none" placeholder="Digite para pesquisar um material...">
                            <datalist id="materialDatalist"></datalist>
                        </div>
                        <div class="md:col-span-2">
                            <label for="quantidadeMaterialOrcamento" class="block text-sm font-medium text-sky-700 mb-1">Quantidade</label>
                            <input type="number" id="quantidadeMaterialOrcamento" min="0.01" step="any" value="1" class="w-full px-4 py-3 bg-white border border-slate-300 rounded-lg text-slate-900 focus:ring-2 focus:ring-sky-500 outline-none placeholder-slate-400">
                        </div>
                        <button id="btnAdicionarMaterialOrcamento" class="md:col-span-1 w-full bg-green-500 hover:bg-green-600 text-white font-semibold py-3 px-4 rounded-lg transition">Adicionar</button>
                    </div>
                    <div id="orcamentoFormFeedback" class="mt-3 text-sm"></div>
                </div>
                <div class="mt-8">
                    <h3 class="text-xl font-semibold text-sky-700 mb-4">Itens do Orçamento Atual</h3>
                    <div id="orcamentoItensList" class="space-y-3 mb-4">
                        <p id="orcamentoVazioMsg" class="text-slate-500 text-center p-4 border-2 border-dashed border-slate-300 rounded-md">Nenhum item.</p>
                    </div>
                    <div class="mt-6 p-4 bg-slate-100 rounded-lg shadow">
                        <h4 class="text-lg font-semibold text-sky-700 mb-3 text-center">Resumo do Orçamento</h4>
                        <div class="space-y-2">
                            <div class="orcamento-total-item"><span class="orcamento-total-label">Total Materiais:</span><span class="orcamento-total-value">R$ <span id="orcamentoTotalMateriais">0.00</span></span></div>
                            <div class="orcamento-total-item">
                                <span class="orcamento-total-label">Mão de Obra (<input type="number" id="percentualMaoDeObra" value="120" min="0" class="input-percent"> %):</span>
                                <span class="orcamento-total-value">R$ <span id="orcamentoValorMaoDeObra">0.00</span></span>
                            </div>
                            <div class="orcamento-total-item"><span class="orcamento-total-label">Subtotal (Materiais + M.O.):</span><span class="orcamento-total-value">R$ <span id="orcamentoSubtotalComMaoDeObra">0.00</span></span></div>
                            <div class="orcamento-total-item"><span class="orcamento-total-label">ISSQN (2% sobre Subtotal):</span><span class="orcamento-total-value">R$ <span id="orcamentoValorISSQN">0.00</span></span></div>
                            <div class="orcamento-total-item">
                                <span class="orcamento-total-label">Frete:</span>
                                <div class="flex items-center">
                                    <span class="mr-1">R$</span>
                                    <input type="number" id="valorFrete" value="0" min="0" step="0.01" class="input-currency">
                                </div>
                            </div>
                            <div class="orcamento-total-item orcamento-total-geral pt-3 mt-2 border-t-2 border-sky-500"><span class="orcamento-total-label">TOTAL DO ORÇAMENTO:</span><span class="orcamento-total-value">R$ <span id="orcamentoTotalFinal">0.00</span></span></div>
                        </div>
                    </div>
                    <div class="mt-8 flex flex-col sm:flex-row justify-center items-center space-y-4 sm:space-y-0 sm:space-x-4">
                        <button id="btnSalvarOrcamento" class="w-full sm:w-auto bg-teal-600 hover:bg-teal-700 text-white font-semibold py-3 px-8 rounded-lg transition">Salvar Orçamento</button>
                        <button id="btnImprimirOrcamento" class="w-full sm:w-auto bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 px-8 rounded-lg transition">Imprimir / Gerar PDF</button>
                    </div>
                    <div id="cancelEditContainer" class="mt-4 text-center" style="display: none;">
                        <button id="btnCancelarEdicao" class="text-sm text-red-600 hover:underline">Cancelar Edição</button>
                    </div>
                    <div id="salvarOrcamentoFeedback" class="mt-4 text-sm text-center"></div>
                </div>
            </section>

            <hr class="app-section-separator border-slate-300 my-10" style="display: none;">
            
            <section id="saved-budgets-section" class="app-section mb-10" style="display: none;">
                <h2 class="text-2xl font-semibold text-sky-600 mb-6 text-center">Orçamentos Salvos</h2>
                <div class="mb-6 flex items-center space-x-2">
                    <div class="flex-grow">
                        <label for="searchSavedBudgets" class="block text-sm font-medium text-sky-700 mb-1">Pesquisar Orçamentos</label>
                        <input type="text" id="searchSavedBudgets" class="w-full px-4 py-3 bg-slate-50 border border-slate-300 rounded-lg text-slate-900 focus:ring-2 focus:ring-sky-500 outline-none placeholder-slate-400" placeholder="Nome do cliente, descrição ou item...">
                    </div>
                    <button id="btnSearchSavedBudgets" class="self-end px-5 py-3 bg-sky-500 text-white rounded-lg hover:bg-sky-600 focus:outline-none focus:ring-2 focus:ring-sky-500">Pesquisar</button>
                </div>
                
                <div id="loadingSavedBudgetsMessage" class="flex flex-col items-center justify-center p-8 text-slate-500">
                    <svg class="animate-spin h-8 w-8 text-sky-600 mb-4" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                    </svg>
                    <p class="text-lg">Carregando orçamentos...</p>
                </div>

                <div id="savedBudgetsList" class="space-y-4" style="display: none;"></div>
                <p id="savedBudgetsInfoMessage" class="text-slate-500 text-center p-4 border-2 border-dashed border-slate-300 rounded-md" style="display: none;">Digite e clique em "Pesquisar" para ver os orçamentos salvos.</p>
                <p id="noSavedBudgetsMessage" class="text-slate-500 text-center" style="display: none;">Nenhum orçamento salvo encontrado ou correspondente à pesquisa.</p>
            </section>

            <hr class="app-section-separator border-slate-300 my-10" style="display: none;">

            <section id="form-section" class="app-section mb-8" style="display: none;">
                <h2 class="text-xl font-semibold text-sky-700 mb-4 text-center">Cadastrar Novo Material no Catálogo</h2>
                <form id="addMaterialForm" class="space-y-6">
                    <div>
                        <label for="materialName" class="block text-sm font-medium text-sky-700 mb-1">Nome</label>
                        <input type="text" id="materialName" required class="w-full px-4 py-3 bg-slate-50 border border-slate-300 rounded-lg text-slate-900 focus:ring-2 focus:ring-sky-500 outline-none placeholder-slate-400" placeholder="Ex: Barra de Ferro Chato 1/8">
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label for="materialUnit" class="block text-sm font-medium text-sky-700 mb-1">Unidade</label>
                            <input type="text" id="materialUnit" required class="w-full px-4 py-3 bg-slate-50 border border-slate-300 rounded-lg text-slate-900 focus:ring-2 focus:ring-sky-500 outline-none placeholder-slate-400" placeholder="Ex: Metro, KG, Unidade">
                        </div>
                        <div>
                            <label for="materialPrice" class="block text-sm font-medium text-sky-700 mb-1">Preço (R$)</label>
                            <input type="number" id="materialPrice" step="0.01" required class="w-full px-4 py-3 bg-slate-50 border border-slate-300 rounded-lg text-slate-900 focus:ring-2 focus:ring-sky-500 outline-none placeholder-slate-400" placeholder="Ex: 25.50">
                        </div>
                    </div>
                    <button type="submit" class="w-full bg-sky-600 hover:bg-sky-700 text-white font-semibold py-3 px-6 rounded-lg transition">Adicionar ao Catálogo</button>
                </form>
                <div id="formFeedback" class="mt-4 text-sm"></div>
            </section>

            <hr class="app-section-separator border-slate-300 my-10" style="display: none;">

            <section id="list-section" class="app-section mb-10" style="display: none;">
                <div class="mb-6 flex items-center space-x-2">
                    <div class="flex-grow">
                        <label for="searchMaterials" class="block text-sm font-medium text-sky-700 mb-1">Pesquisar Catálogo</label>
                        <input type="text" id="searchMaterials" class="w-full px-4 py-3 bg-slate-50 border border-slate-300 rounded-lg text-slate-900 focus:ring-2 focus:ring-sky-500 outline-none placeholder-slate-400" placeholder="Nome do material...">
                    </div>
                    <button id="btnSearchMaterials" class="self-end px-5 py-3 bg-sky-500 text-white rounded-lg hover:bg-sky-600 focus:outline-none focus:ring-2 focus:ring-sky-500">Pesquisar</button>
                </div>
                <h2 class="text-2xl font-semibold text-sky-600 mb-6 text-center">Catálogo de Materiais</h2>
                <div id="materialsList" class="space-y-4" style="display: none;"></div>
                
                <div id="loadingMessage" class="flex flex-col items-center justify-center p-8 text-slate-500">
                    <svg class="animate-spin h-8 w-8 text-sky-600 mb-4" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                    </svg>
                    <p class="text-lg">Carregando catálogo...</p>
                </div>

                <p id="catalogInfoMessage" class="text-slate-500 text-center p-4 border-2 border-dashed border-slate-300 rounded-md" style="display: none;">Digite e clique em "Pesquisar" para ver.</p>
                <p id="noResultsMessage" class="text-slate-500 text-center" style="display: none;">Nenhum material encontrado.</p>
            </section>
        </div>
    </div>


    <div id="printableArea">
        </div>
    <div id="confirmDeleteMaterialModal" class="modal no-print">
        </div>
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, onAuthStateChanged, GoogleAuthProvider, signInWithPopup, signOut } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, collection, addDoc, onSnapshot, doc, deleteDoc, updateDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        const firebaseConfig = {
         apiKey: "AIzaSyDNoUVzHRmYNnfd-Vi9yskTlugIV2HsZQ4",
         authDomain: "app-serralheria-c5525.firebaseapp.com",
         projectId: "app-serralheria-c5525",
         storageBucket: "app-serralheria-c5525.appspot.com", 
         messagingSenderId: "838030423072",
         appId: "1:838030423072:web:ba1f50774cd612e60b7845"
        };
        
        const appId = firebaseConfig.projectId;

        const NOME_EMPRESA = "Serralheria Bom Preço";
        const ENDERECO_EMPRESA = "RUA SÃO MATEUS, 24 - BAIRRO NOVA SANTA MARTA - SANTA MARIA / RS - CEP: 97037-008";
        const CONTATO_EMPRESA = "CNPJ: 11.586.234/0001-89 | Fone/WhatsApp: (55) 3226-1949";
        const LOGO_URL = "https://i.imgur.com/RH15o8N.jpeg"; 

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const auth = getAuth(app);

        let userId = null;
        let materialsCollectionRef = null;
        let savedBudgetsCollectionRef = null; 
        let clientsCollectionRef = null;
        let allMaterials = [];
        let orcamentoAtual = []; 
        let allSavedBudgets = [];
        let allClients = [];
        let unsubscribeMaterials = null;
        let unsubscribeBudgets = null;
        let unsubscribeClients = null;

        const loginScreen = document.getElementById('login-screen');
        const homeScreen = document.getElementById('home-screen');
        const mainAppContent = document.getElementById('main-app-content');
        
        const appSections = document.querySelectorAll('.app-section');
        const sectionSeparators = document.querySelectorAll('.app-section-separator');

        const googleLoginBtn = document.getElementById('google-login-btn');
        const logoutBtn = document.getElementById('logout-btn');
        const logoutBtnHome = document.getElementById('logout-btn-home');
        const userEmailDisplay = document.getElementById('userEmailDisplay');
        const userEmailDisplayHome = document.getElementById('userEmailDisplayHome');
        const loginFeedback = document.getElementById('loginFeedback');
        const loginLogo = document.getElementById('loginLogo');
        const loginCompanyName = document.getElementById('loginCompanyName');
        const homeLogo = document.getElementById('homeLogo');
        const homeCompanyName = document.getElementById('homeCompanyName');

        const btnBackToHome = document.getElementById('btn-back-to-home');
        const btnGotoOrcamentos = document.getElementById('btn-goto-orcamentos');
        const btnGotoClientes = document.getElementById('btn-goto-clientes');
        const btnGotoCatalogo = document.getElementById('btn-goto-catalogo');
        const btnGotoNovoOrcamento = document.getElementById('btn-goto-novo-orcamento');

        // ... todas as outras referências de DOM ...

        const handleGoogleLogin = async () => {
            console.log("Botão 'Entrar com Google' clicado. Tentando iniciar o processo de login...");
            const feedbackElem = document.getElementById('loginFeedback');
            
            if (!auth) {
                const errorMsg = "Erro Crítico: Serviço de autenticação do Firebase não foi inicializado.";
                console.error(errorMsg);
                if (feedbackElem) feedbackElem.textContent = errorMsg;
                return;
            }

            const provider = new GoogleAuthProvider();
            try {
                await signInWithPopup(auth, provider);
                console.log("Popup de login do Google chamado com sucesso.");
            } catch (error) {
                console.error("Erro durante o signInWithPopup:", error);
                if (feedbackElem) feedbackElem.textContent = `Erro: ${error.code}. Verifique o console.`;
            }
        };

        function showHomeScreen() {
            homeScreen.style.display = 'block';
            mainAppContent.style.display = 'none';
        }

        function navigateToSection(targetId) {
            homeScreen.style.display = 'none';
            mainAppContent.style.display = 'block';
            
            appSections.forEach(section => section.style.display = 'none');
            sectionSeparators.forEach(hr => hr.style.display = 'none');

            const targetSection = document.getElementById(targetId);
            if (targetSection) {
                targetSection.style.display = 'block';
                let nextElement = targetSection.nextElementSibling;
                if (nextElement && nextElement.classList.contains('app-section-separator')) {
                    nextElement.style.display = 'block';
                }
            }

            if (targetId === 'form-section') {
                const listSection = document.getElementById('list-section');
                if(listSection) {
                    listSection.style.display = 'block';
                    let prevElement = listSection.previousElementSibling;
                    if (prevElement && prevElement.classList.contains('app-section-separator')) {
                        prevElement.style.display = 'block';
                    }
                }
            }
            window.scrollTo(0, 0);
        }

        function setupNavigation() {
            btnBackToHome.addEventListener('click', showHomeScreen);
            btnGotoClientes.addEventListener('click', () => navigateToSection('clients-section'));
            btnGotoOrcamentos.addEventListener('click', () => navigateToSection('saved-budgets-section'));
            btnGotoCatalogo.addEventListener('click', () => navigateToSection('form-section'));
            btnGotoNovoOrcamento.addEventListener('click', () => navigateToSection('orcamento-section'));
        }

        onAuthStateChanged(auth, (user) => {
            if (user) {
                // ...
            } else {
                // ...
            }
        });

        // O restante das suas funções (isValidCPF, renderClients, etc.) continua aqui.
        // Adicionando o listener de clique principal no final, envolto em DOMContentLoaded.

        document.addEventListener('DOMContentLoaded', () => {
             const googleLoginBtnElem = document.getElementById('google-login-btn');
             if (googleLoginBtnElem) {
                 console.log("Botão de login do Google encontrado. Adicionando listener.");
                 googleLoginBtnElem.addEventListener('click', handleGoogleLogin);
             } else {
                 console.error("ERRO CRÍTICO: Botão de login com id 'google-login-btn' não foi encontrado no HTML.");
             }
        });

    </script>
</body>
</html>